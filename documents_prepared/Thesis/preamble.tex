\usepackage[subpreambles=false,group=false]{standalone}

\usepackage{geometry}
\geometry{a4paper, inner=3cm, outer=3cm, top=2cm, bottom=2cm}



\usepackage{xcolor}
\usepackage{environ}
\usepackage{xparse}
\usepackage{luatex85}

\setlength{\marginparwidth}{2.5cm}
\usepackage[textwidth=2.5cm]{todonotes}



\usepackage{fancyhdr}
\pagecolor{white}
\usepackage{pdfpages}
\usepackage{bookmark}

\usepackage{etoolbox}
\usepackage{afterpage}

\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.15}
\DeclareMathVersion{tabularbold}
\SetSymbolFont{operators}{tabularbold}{OT1}{cmr}{b}{n} %TODO Check this font is right


\usepackage{graphicx}
\graphicspath{{./figs/}, {./},{./figs/chapterwordrepr},{./figs/chaptersentencerrepr/}, {./figs/chapterintromachinelearning/}}
\usepackage[space]{grffile}
\usepackage{subfig}

\usepackage{enumitem}

\usepackage{pifont}
\usepackage{latexsym}
\usepackage[boxed]{algorithm2e}





\input{preamble-math.tex}
\input{preamble-tikz.tex}
\usepackage{cleveref}



%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[
backend=bibtex,
url=false,  
style=alphabetic,
citestyle=authoryear,
bibstyle=authoryear,
maxbibnames=99,
dashed=false,
%refsection=chapter
]{biblatex}


\addbibresource{master}
\newcommand{\citep}[1]{\parencite{#1}}
\newcommand{\citet}[1]{\textcite{#1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Page boarders
\definecolor{bordercolor}{named}{blue}
\newcommand{\drawpageborders}{\tikz[remember picture,overlay]{
		\draw [color=bordercolor, line width=2mm] (current page.south east) rectangle (current page.north east);
		\draw [color=bordercolor, line width=2mm] (current page.south west) rectangle (current page.north west);
	}
}

%%%%%%


\makeatletter
\def\afternextchapter{}
\apptocmd{\@chapter}{%
	{%
		% Set chapters boarder colors
		\xglobal\definecolor{bordercolor}{RGB}{\pdfuniformdeviate 255,\pdfuniformdeviate 255,\pdfuniformdeviate 255}%	
		\thispagestyle{fancy}
		
		\afternextchapter{}%
		\gdef\afternextchapter{} % clear it	
	 }%
	 }{}{}
\makeatother
%%%%%%%%%%%%%%%%%%%%
% Capture name of the part

\newcommand{\parttitle}{}
\newcommand{\chaptertitle}{}
\makeatletter

\patchcmd{\@part}% <cmd>
{\markboth}% <search>
{\renewcommand{\parttitle}{#1}}% <replace>
{}{}% <success><failure>

\patchcmd{\@chapter}% <cmd>
{\markboth}% <search>
{\renewcommand{\chaptertitle}{#1}}% <replace>
{}{}% <success><failure>
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Page layout


\fancypagestyle{plain}{%
	\fancyhf{} % clear all header and footer fields
	\fancyfoot[RO,LE]{\thepage}
	\renewcommand{\headrulewidth}{0pt}
	\renewcommand{\footrulewidth}{0pt}}

\pagestyle{fancy}
	\fancyhf{}
	\fancyhead[C]{\drawpageborders{}}
	\fancyhead[L]{\parttitle}
	\fancyhead[R]{\chaptertitle}
	\fancyfoot[RO,LE]{\thepage}



\DeclareDocumentCommand{\inputpublication}{m}{
	\cleardoublepage
	\pagestyle{fancy}
	
	\gdef\afternextchapter{%
		\label{#1}
	}
	\input{pub#1.tex}
}



%%%%%

\makeatletter
\NewEnviron{abstract}{%
	\small
	\begin{center}%
		{\bfseries Abstract\vspace{-.5em}\vspace{\z@}}%
	\end{center}%
	\quotation
	\noindent\BODY
	\endquotation
}
\makeatother

\newcommand{\preamble}[1]{{\sffamily \footnotesize #1\\ \vspace{0.5cm}}}

\DeclareDocumentCommand{\dictum}{o m}{
	\hfill\begin{minipage}{0.5\textwidth}
		\itshape
		#2
	\end{minipage}\\
	\hfill	-- 	#1
	\\
	\vspace{1cm}	
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
\makeatletter % Center all floats
\g@addto@macro\@floatboxreset{\centering}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\natlang}[1]{\texttt{#1}}