\documentclass{standalone}

\input{../../preamble-tikz.tex}
\input{../../preamble-math.tex}
\usetikzlibrary{calc}
\begin{document}

\begin{tikzpicture}[]


\node(w1) {$\n w_{i-1}$};
\node(w2)[right = of w1] {$\n w_{i-2}$};


\node(Cn)[lookupbox, above left=of w1] {$\vdots$};
\def\tblmax{6}
\foreach \ii in {1,...,\tblmax} {
	\pgfmathsetmacro\pos{(\ii - 1) * 3 };
	\pgfmathtruncatemacro\jj{(\tblmax -\ii)};
	
	\node(C\ii)[lookupbox, above = \pos mm of Cn]{$\bullet\bullet\bullet\bullet\bullet\bullet$};
	\node(Clbl\ii)[left = 0mm of C\ii]{\footnotesize $\i C_\jj$:};
};
\node(C)[above = 0mm of C\tblmax.north, text width=40] {\small \textsc{Input \\Embedding Table}};


\node(concat1)[layer, above = 5 of w1]{$\i C_{\n w_{i-1}}$};
\node(concat2)[layer, right = 0 of concat1]{$\i C_{\n w_{i-2}}$};

\draw[->] (w1) edge (C3.east);
\draw[->]  (C3.east) edge (concat1.south);
\draw[->] (w2) edge (C5.east);
\draw[->]  (C5.east) edge (concat2.south);

\node(L1)[layer, above = of concat1.north east]{$\varphi\left(U\,\dv z_{embs} + \v b\right)$};
\draw[->]  (concat1.north east) -- node[labe]{$\dv z_{embs}$} (L1);

$\frac{\exp{\i V_{\n w_i,:} \dv z_{hid} + \iv k_{\n w_i,:}}}%
{\sum_{\forall j} \exp{\i V_{j,:} \dv z_{hid} + \iv k_j}}$
};
\draw[->]  (L1) edge node[labe]{$\dv z_{hid}$} (L2);


\node(out)[above = of L2]{$P(\n w_i \mid \n w_{i-1}, \n w_{i-2})$};
\draw[->] (L2) edge (out);

\node(Vn)[lookupbox, above = 5 of Cn] {$\vdots$};
\def\tblmax{6}
\foreach \ii in {1,...,\tblmax} {
	\pgfmathsetmacro\pos{(\ii - 1) * 3 };
	\pgfmathtruncatemacro\jj{(\tblmax -\ii)};
	
	\node(V\ii)[lookupbox, above = \pos mm of Vn]{$\bullet\bullet\bullet\bullet\bullet\bullet$};
	\node(Vlbl\ii)[left = 0mm of V\ii]{\footnotesize $\i V_{\jj,:}$:};
	
	\pgfmathsetmacro\ang{(\ii * -2 + -180+20 };
	\draw[->] (V\ii.east) -- (L2.\ang);
};
\draw[->] (Vn.east) -- (L2.south west);
\node(C)[above = 0mm of V\tblmax.north, text width=40] {\small \textsc{Output \\Embedding Table}};




\draw[->] (out.204) -- (V6.east);
\draw[->] (V6.east)-- (L2.120);

\end{tikzpicture}

\end{document}