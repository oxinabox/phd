\documentclass{article}

\input{../../preamble-tikz.tex}

\begin{document}

\begin{tikzpicture}[]

\newcommand{\hsep}{5}
\newcommand{\vtablesep}{5}

\node(w1) {$w_{i-1}$};
\node(w2)[left = \hsep of w1] {$\n w_{i-2}$};
\node(w3)[left = \hsep of w2] {$\ldots$};


\node(Cn)[lookupbox, above left=of w2] {$\vdots$};
\def\tblmax{6}
\foreach \ii in {1,...,\tblmax} {
	\pgfmathsetmacro\pos{(\ii - 1) * 3 };
	\pgfmathtruncatemacro\jj{(\tblmax -\ii)};
	
	\node(C\ii)[lookupbox, above = \pos mm of Cn]{$\bullet\bullet\bullet\bullet\bullet\bullet$};
	\node(Clbl\ii)[left = 0mm of C\ii]{\footnotesize $\i C_\jj$:};
};
\node(C)[above = 0mm of C\tblmax] {\small \textsc{Embedding Table}};

\node(L11)[layer, above = \vtablesep of w1]{RU\\$\varphi\left( U\nv h_{i-2}  +  \i C_{\n w_{i-1}}\right)$};
\node(L21)[layer, above = of L11]{$\i {\softmax\left(V \nv h_{i-1}\right)}_{\n w_i}$};
\draw[->]  (L11) edge node[labe]{$\nv h_{i-1}$} (L21);
\node(out1)[above = of L21]{$P(\n w_i \mid \n w_{i-1}, \ldots,  \n w_1)$};
\draw[->] (L21) edge (out1);

\node(L12)[layer, above = \vtablesep of w2]{RU\\$\varphi\left( U\nv h_{i-3}  +  \i C_{\n w_{i-2}}\right)$};
\node(L22)[layer, above = of L12]{$\i {\softmax{\left(V \nv h_{i-2} \right)}}_{\n w_{i-1}}$};
\draw[->]  (L12) edge node[labe]{$\nv h_{i-2}$} (L22);
\node(out2)[above = of L22]{$P(\n w_{i-1} \mid \n w_{i-2}, \ldots,  \n w_1)$};
\draw[->] (L22) edge (out2);
\draw[->]  (L12) edge node[labe]{$\nv h_{i-2}$} (L11);

\node(L13)[layer, above = \vtablesep of w3, dotted] {RU\\\vphantom{$\varphi\left( U\nv h_{i-3}  +  \i C_{\n w_{i-2}}\right)$}$\ldots$};
\draw[->]  (L13) edge node[labe]{$\nv h_{i-3}$} (L12);


\draw[->] (w1) edge (C3.east);
\draw[->]  (C3.east) edge (L11.south);
\draw[->] (w2) edge (C5.east);
\draw[->]  (C5.east) edge (L12.south);


\end{tikzpicture}

\end{document}